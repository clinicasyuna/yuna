rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // === REGRAS GERAIS ===
    // Permitir acesso para usuários autenticados (temporariamente mais permissivo)
    match /{document=**} {
      allow read, write: if request.auth != null;
    }
    
    // === USUÁRIOS ADMINISTRADORES ===
    match /usuarios_admin/{userId} {
      // Leitura: usuário autenticado pode ler
      allow read: if request.auth != null;
      
      // Criação/Edição: qualquer usuário autenticado (será refinado depois)
      allow create, update: if request.auth != null;
      
      // Exclusão: qualquer usuário autenticado (será refinado depois)
      allow delete: if request.auth != null;
    }
    
    // === USUÁRIOS DA EQUIPE ===
    match /usuarios_equipe/{userId} {
      // Permitir acesso completo para usuários autenticados
      allow read, write: if request.auth != null;
    }
    
    // === USUÁRIOS ACOMPANHANTES ===
    match /usuarios_acompanhantes/{userId} {
      // Permitir acesso completo para usuários autenticados
      allow read, write: if request.auth != null;
    }
    
    // === SOLICITAÇÕES ===
    match /solicitacoes/{solicitacaoId} {
      // REGRA TEMPORÁRIA: Permitir acesso completo para usuários autenticados
      // TODO: Implementar filtragem por departamento no frontend
      allow read, write: if request.auth != null;
    }
    
    // === AVALIAÇÕES DE SATISFAÇÃO ===
    match /avaliacoes_satisfacao/{avaliacaoId} {
      // Permitir acesso completo para usuários autenticados
      allow read, write: if request.auth != null;
    }
    
    // === QUARTOS OCUPADOS ===
    match /quartos_ocupados/{quartoId} {
      // Permitir acesso completo para usuários autenticados
      allow read, write: if request.auth != null;
    }
    
    // === LOGS DE AUDITORIA ===
    match /logs_auditoria/{logId} {
      // Permitir leitura para usuários autenticados
      allow read: if request.auth != null;
      
      // Permitir criação apenas se o usuário está incluindo seu próprio UID
      allow create: if request.auth != null 
        && request.auth.uid != null
        && (
          !('usuarioId' in resource.data) || 
          resource.data.usuarioId == request.auth.uid ||
          resource.data.usuarioId == 'anonimo'
        );
      
      // Exclusão/Edição: proibida (logs são imutáveis)
      allow update, delete: if false;
    }
  }
}